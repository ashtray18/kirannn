<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Kiran ‚ù§Ô∏è</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #ffe6e6; /* Soft Pink */
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden;
        }

        #start-btn {
            padding: 15px 30px;
            font-size: 20px;
            background-color: #ff4d4d;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 77, 77, 0.4);
            transition: transform 0.2s;
            z-index: 10;
        }

        #start-btn:hover {
            transform: scale(1.05);
        }

        /* Valentine question buttons */
        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
            pointer-events: auto;
        }

        .valentine-btn {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .yes-btn {
            background-color: #ff4d4d;
            color: white;
            box-shadow: 0 4px 15px rgba(255, 77, 77, 0.4);
        }

        .yes-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255, 77, 77, 0.5);
        }

        .no-btn {
            background-color: #e0e0e0;
            color: #333;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .no-btn:hover {
            background-color: #d0d0d0;
        }

        /* Container for the messages */
        #message-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            max-width: 400px;
            display: none; /* Hidden until start */
            flex-direction: column;
            gap: 15px;
            pointer-events: none;
            z-index: 5;
        }

        /* macOS-style Dialogue Box */
        .dialogue-box {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            text-align: center;
            opacity: 0;
            transform: translateY(20px) scale(0.9);
            transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1);
            border: 1px solid rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin: 0 auto;
            width: 80%;
        }

        .dialogue-box.show {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        .dialogue-text {
            color: #333;
            font-size: 18px;
            font-weight: 500;
            line-height: 1.4;
        }

        .heart-signature {
            color: #ff4d4d;
            font-weight: bold;
            font-size: 20px;
            margin-top: 10px;
        }
        
        /* audio element hidden (we use the <audio> element instead of youtube) */
        #music-player, #music-player-audio {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            pointer-events: none;
            z-index: -1;
        }

        /* valentines background & lowercase styling */
        body {
            background: radial-gradient(circle at 20% 10%, #fff7fb, #ffe6f0 30%, #ffdfe6 60%), linear-gradient(180deg,#ffe6e6,#fff0f5);
            min-height: 100vh;
            text-transform: lowercase;
            color: #3a1a1a;
        }

        /* floating kiss images */
        #hearts {
            position: fixed;
            inset: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }

        .floating-kiss {
            position: absolute;
            bottom: -40px;
            width: 34px;
            height: 34px;
            opacity: 0.95;
            animation-name: floatUp;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            transform-origin: center;
            filter: drop-shadow(0 8px 16px rgba(255,77,77,0.12));
            will-change: transform, opacity;
            object-fit: contain;
        }

        @keyframes floatUp {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0.95; }
            30% { opacity: 1; }
            100% { transform: translateY(-120vh) translateX(30px) rotate(25deg); opacity: 0; }
        }

        /* dialogue tweaks */
        .dialogue-box {
            background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,250,250,0.95));
            border: 1px solid rgba(255,77,77,0.12);
            color: #3a1a1a;
        }
        .dialogue-text { font-size: 18px; color: #4a2a2a; }
        .heart-signature { font-family: 'cursive', 'Segoe Script', sans-serif; font-size: 20px; color: #ff2d6b; }

        /* end photo + cute caption */
        #end-image-container { position: fixed; inset: auto 0 5% 0; display:flex; justify-content:center; z-index:7; pointer-events:none; flex-direction:column; align-items:center; gap:8px; }
        .photo-frame { background: linear-gradient(135deg, rgba(255,240,245,0.95), rgba(255,230,240,0.85)); padding: 10px; border-radius: 16px; border: 2px solid rgba(255,90,130,0.12); display:flex; align-items:center; justify-content:center; box-shadow: 0 30px 70px rgba(255,30,80,0.08); position: relative; transform: translateY(6px) scale(0.98); transition: all 0.7s cubic-bezier(0.22, 1, 0.36, 1); max-width: 820px; max-height: 70vh; overflow: hidden; }
        .photo-frame.show { transform: translateY(0) scale(1); animation: popIn 700ms cubic-bezier(0.22,1,0.36,1); }
        .end-photo { display:block; border-radius:12px; width: auto; height: auto; max-width: calc(80vw - 40px); max-height: calc(70vh - 40px); object-fit: contain; opacity:0; transform: translateY(12px) scale(0.98); transition: all 0.9s cubic-bezier(0.22, 1, 0.36, 1); }
        .end-photo.show { opacity:1; transform: translateY(0) scale(1); }
        .photo-caption { font-family: 'cursive', 'Segoe Script', sans-serif; color: #ff2d6b; font-size: 16px; text-transform: lowercase; margin-top: 6px; opacity: 0; transform: translateY(8px); transition: all 0.6s ease; }
        .photo-caption.show { opacity: 1; transform: translateY(0); }

        @keyframes popIn { 0% { transform: scale(0.9); opacity:0 } 60% { transform: scale(1.04); } 100% { transform: scale(1); opacity:1 } }

        .mini-heart { position: absolute; font-size: 20px; animation: floatUpShort 1.4s ease-out forwards; }
        @keyframes floatUpShort { 0% { transform: translateY(0) scale(0.9); opacity:1 } 100% { transform: translateY(-48px) scale(1.2); opacity:0 } }

        /* overlay for manual play if autoplay blocked */
        #play-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 11; pointer-events: auto; }
        #play-overlay .btn { background: rgba(255,77,77,0.95); color: #fff; padding: 14px 24px; border-radius: 999px; font-size: 18px; box-shadow: 0 8px 30px rgba(255,77,77,0.18); cursor:pointer; }
    </style>
</head>
<body>

    <button id="start-btn" onclick="startSurprise()">click me kiran üíå</button>
    <div id="play-overlay" aria-hidden="true" style="display:none"><div class="btn" onclick="audio && audio.play(); this.parentNode.style.display='none'">tap to play song</div></div>

    <audio id="music-player-audio" src="song.mp3" preload="auto"></audio>
    <div id="hearts" aria-hidden="true"></div>
    <div id="end-image-container"></div>

    <div id="message-container"></div>

    <script>
        // lyrics and messages sequence (all lowercase)
        // timings: "i know that i'll love you always" lasts ~4s, then "yeah girl you, and i like that." also lasts ~4s
        const lyrics = [
            { text: "maybe we'll get married one day, but who knows?", offset: 0 },
            { text: "think i'll take that thought to the grave, but who knows?", offset: 8 },
            { text: "i know that i'll love you always", offset: 16 },
            { text: "yeah girl you, and i like that.", offset: 20 },
            { text: "will you be my valentine, kiran?", offset: 24, isQuestion: true },
            { text: "i love you <3 muahh", offset: 28 }
        ];

        // note: offsets are seconds relative to the audio start time (3:10). adjust offsets if you want different spacing.

        // note: offsets are seconds relative to the audio start time (2:50). adjust as needed for perfect sync.

        let player;

        // local mp3 audio setup (drop 'song.mp3' into project root or update src)
        const audio = document.getElementById('music-player-audio');
        // start time in seconds (3 minutes 10 seconds)
        const startTime = 190; // plays from 3:10 onwards

        function prepareAndPlayAudio() {
            if (!audio) return;
            audio.volume = 0.9;

            function startOnceReady() {
                try {
                    audio.currentTime = startTime;
                } catch (e) {
                    // seeking might fail until metadata is loaded; handled in canplay listener
                }
                audio.play().catch(err => {
                    console.warn('playback prevented', err);
                    const overlay = document.getElementById('play-overlay');
                    if (overlay) overlay.style.display = 'flex';
                });
            }

            if (audio.readyState >= 2) {
                startOnceReady();
            } else {
                audio.addEventListener('canplay', startOnceReady, { once: true });
            }
        }

        // generate flowing kiss images background (uses kiss.png - add file to project root)
        function generateHearts(count = 30) {
            const container = document.getElementById('hearts');
            if (!container) return;
            for (let i = 0; i < count; i++) {
                const img = document.createElement('img');
                img.className = 'floating-kiss';
                img.src = 'kiss.png'; // place kiss.png in project root
                img.style.left = Math.random() * 100 + '%';
                img.style.animationDelay = (Math.random() * 6) + 's';
                img.style.animationDuration = (6 + Math.random() * 10) + 's';
                const size = 18 + Math.random() * 30;
                img.style.width = size + 'px';
                img.style.height = size + 'px';
                img.style.opacity = 0.75 + Math.random() * 0.25;
                container.appendChild(img);
            }
        }

        // call on load
        generateHearts(30);

        function startSurprise() {
            // Hide button and show container
            document.getElementById('start-btn').style.display = 'none';
            const container = document.getElementById('message-container');
            container.style.display = 'flex';

            // start audio from the requested offset
            prepareAndPlayAudio();

            // use audio time-based syncing for more accurate alignment
            const displayed = new Array(lyrics.length).fill(false);
            let endImageScheduled = false;

            function showLine(line, idx) {
                const box = document.createElement('div');
                box.className = 'dialogue-box';
                
                if (line.isQuestion) {
                    // Show valentine question with buttons
                    box.innerHTML = `<div class="dialogue-text">"${line.text}"</div>`;
                    container.appendChild(box);
                    setTimeout(() => { box.classList.add('show'); }, 50);
                    
                    // Add buttons container
                    const buttonContainer = document.createElement('div');
                    buttonContainer.className = 'button-container';
                    
                    let yesBtnSize = 1;
                    const yesBtn = document.createElement('button');
                    yesBtn.className = 'valentine-btn yes-btn';
                    yesBtn.innerText = 'yes üíï';
                    yesBtn.style.transform = `scale(${yesBtnSize})`;
                    
                    const noBtn = document.createElement('button');
                    noBtn.className = 'valentine-btn no-btn';
                    noBtn.innerText = 'no';
                    
                    noBtn.onclick = (e) => {
                        e.preventDefault();
                        yesBtnSize += 0.2;
                        yesBtn.style.transform = `scale(${yesBtnSize})`;
                        yesBtn.style.transition = 'transform 0.3s ease';
                    };
                    
                    yesBtn.onclick = (e) => {
                        e.preventDefault();
                        // Remove buttons and continue to next message
                        buttonContainer.style.opacity = '0';
                        buttonContainer.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            box.remove();
                            buttonContainer.remove();
                            // Continue with remaining lyrics
                            for (let i = idx + 1; i < lyrics.length; i++) {
                                if (!displayed[i]) {
                                    displayed[i] = true;
                                    showLine(lyrics[i], i);
                                    if (i === lyrics.length - 1 && !endImageScheduled) {
                                        endImageScheduled = true;
                                        setTimeout(showEndImage, 3000);
                                    }
                                }
                            }
                        }, 600);
                    };
                    
                    buttonContainer.appendChild(yesBtn);
                    buttonContainer.appendChild(noBtn);
                    container.appendChild(buttonContainer);
                    setTimeout(() => { buttonContainer.style.opacity = '1'; }, 50);
                } else if (idx >= lyrics.length - 2) {
                    box.innerHTML = `<div class="heart-signature">${line.text}</div>`;
                    container.appendChild(box);
                    setTimeout(() => { box.classList.add('show'); }, 50);
                    if (container.children.length > 1) {
                        const prev = container.children[container.children.length - 2];
                        prev.style.opacity = '0';
                        prev.style.transform = 'translateY(-20px)';
                        setTimeout(() => prev.remove(), 600);
                    }
                } else {
                    box.innerHTML = `<div class="dialogue-text">"${line.text}"</div>`;
                    container.appendChild(box);
                    setTimeout(() => { box.classList.add('show'); }, 50);
                    if (container.children.length > 1) {
                        const prev = container.children[container.children.length - 2];
                        prev.style.opacity = '0';
                        prev.style.transform = 'translateY(-20px)';
                        setTimeout(() => prev.remove(), 600);
                    }
                }
            }

            function showEndImage() {
                const imgContainer = document.getElementById('end-image-container');

                const frame = document.createElement('div');
                frame.className = 'photo-frame';

                const img = document.createElement('img');
                img.src = 'kiran.jpg';
                img.alt = 'ashy & kiki üíï';
                img.className = 'end-photo';
                frame.appendChild(img);
                imgContainer.appendChild(frame);

                const caption = document.createElement('div');
                caption.className = 'photo-caption';
                caption.innerText = 'ashy & kiki üíï';
                imgContainer.appendChild(caption);

                // show with cute animation
                setTimeout(() => {
                    frame.classList.add('show');
                    img.classList.add('show');
                    caption.classList.add('show');
                }, 50);

                // small burst of hearts near the photo
                for (let i = 0; i < 3; i++) {
                    const h = document.createElement('div');
                    h.className = 'mini-heart';
                    h.innerText = '‚ù§Ô∏è';
                    h.style.left = (45 + Math.random() * 20) + '%';
                    h.style.bottom = (12 + Math.random() * 6) + '%';
                    h.style.fontSize = (14 + Math.random() * 12) + 'px';
                    imgContainer.appendChild(h);
                    setTimeout(() => h.remove(), 1400 + Math.random() * 400);
                }
            }

            function onTimeUpdate() {
                const now = audio.currentTime;
                if (now < startTime) return;
                const rel = now - startTime;
                lyrics.forEach((line, idx) => {
                    if (!displayed[idx] && rel >= line.offset) {
                        displayed[idx] = true;
                        showLine(line, idx);
                        // If this is the question, don't auto-continue
                        if (line.isQuestion) {
                            audio.removeEventListener('timeupdate', onTimeUpdate);
                        }
                    }
                });
                if (!endImageScheduled && displayed.every(Boolean)) {
                    endImageScheduled = true;
                    // show image a few seconds after last lyric
                    setTimeout(showEndImage, 3000);
                    audio.removeEventListener('timeupdate', onTimeUpdate);
                }
            }

            audio.addEventListener('timeupdate', onTimeUpdate);
            // in case audio already past start time (e.g., user seeks), run once immediately
            onTimeUpdate();
        }
    </script>

</body>
</html>